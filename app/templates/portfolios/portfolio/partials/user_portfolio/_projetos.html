<div class="tab-pane fade" id="projects" role="tabpanel" aria-labelledby="projects-tab">
    
    <!-- Verifica se o usuário possui projetos -->
    {% if projects %}
    <h4>Projetos</h4>

    <div class="list-group">
        {% for project in projects %}
        
        <!-- Utizar o _projetos_listar.html -->
        {% include 'portfolios/portfolio/partials/user_portfolio/_projetos_listar.html' with project=project %}

        {% endfor %}
    </div>
    
    {% else %}
    <p class="mt-3">Nenhum projeto criado ainda.</p>
    {% endif %}

    <!-- Formulário de criação de projeto (somente para o proprietário) -->
    {% if user == portfolio.user %}
        {% include 'portfolios/portfolio/partials/forms/_create_project.html' with portfolio=portfolio %}
    {% endif %}
</div>

<!-- Modal para visualização do projeto -->
<div class="modal fade" id="projectModal" tabindex="-1" aria-labelledby="projectModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="projectModalLabel">Título do Projeto</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="markdown-content"></div>
            </div>
        </div>
    </div>
</div>

<!-- Script para carregar o projeto via AJAX -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const projectModal = document.getElementById('projectModal');
        const projectModalLabel = projectModal.querySelector('.modal-title');
        const markdownContent = projectModal.querySelector('#markdown-content');
        
        document.querySelectorAll('.project-link').forEach(function(link) {
            link.addEventListener('click', function() {
                const projectName = this.getAttribute('data-project-name');
                const username = this.getAttribute('data-username');
                
                // Faz a requisição AJAX para buscar os dados do projeto
                fetch(`/portfolio/project/${username}/${projectName}/`)
                    .then(response => response.json())
                    .then(data => {
                        // Atualiza o conteúdo do modal
                        projectModalLabel.textContent = data.name;
                        
                        const htmlContent = marked.parse(data.markdown_content);
                        markdownContent.innerHTML = htmlContent;
                    })
                    .catch(error => console.error('Erro ao carregar o projeto:', error));
            });
        });
    });
</script>

<!-- Script para votação -->
<script>
    $('.vote-button').on('click', function(e) {
        e.preventDefault();
        
        const button = $(this);  // Botão clicado
        const form = button.closest('form');
        const url = form.attr('action');
        const svgIcon = button.find('svg');

        $.post(url, function(response) {
            if (response.success) {
                // Alterar o estado para 'votado' e aplicar a animação
                button.addClass('voted').removeClass('unvoted');
                svgIcon.html(`
                    <radialGradient id="IconifyId17ecdb2904d178eab8626" cx="68.884" cy="124.296" r="70.587">
                        <stop offset=".314" stop-color="#ff9800"></stop>
                        <stop offset=".662" stop-color="#ff6d00"></stop>
                        <stop offset=".972" stop-color="#f44336"></stop>
                    </radialGradient>
                    <path d="M35.56 40.73c-.57 6.08-.97 16.84 2.62 21.42c0 0-1.69-11.82 13.46-26.65c6.1-5.97 7.51-14.09 5.38-20.18c-1.21-3.45-3.42-6.3-5.34-8.29c-1.12-1.17-.26-3.1 1.37-3.03c9.86.44 25.84 3.18 32.63 20.22c2.98 7.48 3.2 15.21 1.78 23.07c-.9 5.02-4.1 16.18 3.2 17.55c5.21.98 7.73-3.16 8.86-6.14c.47-1.24 2.1-1.55 2.98-.56c8.8 10.01 9.55 21.8 7.73 31.95c-3.52 19.62-23.39 33.9-43.13 33.9c-24.66 0-44.29-14.11-49.38-39.65c-2.05-10.31-1.01-30.71 14.89-45.11c1.18-1.08 3.11-.12 2.95 1.5z" fill="url(#IconifyId17ecdb2904d178eab8626)"></path>
                `);

                // Tamanho do ícone
                svgIcon.css('width', '25px').css('height', '25px');
            } else {
                // Alterar o estado para 'não votado' e aplicar a animação
                button.addClass('unvoted').removeClass('voted');
                svgIcon.html(`
                    <path d="M508.416 1023.28c-241.248 0-412.369-167.28-412.369-397.777 0-122.368 73.376-254.192 76.496-259.712 6.368-11.343 18.88-17.504 31.936-16.063a32.052 32.052 0 0 1 26.88 23.567c.192.752 19.968 74.752 46.064 115.84 17.536 27.649 35.312 47.185 55.312 60.753-13.536-58.656-23.904-146.912-7.024-237.472C372.047 63.84 567.695 4.368 576.08 1.968c10.784-3.088 22.225-.32 30.433 7.151 8.192 7.504 11.936 18.752 9.808 29.665-.32 1.744-32.624 175.776 35.936 324.064 6.223 13.471 14.912 29.12 24.256 44.784 2.656-21.504 6.784-44.368 13.12-66.56 25.152-87.969 90.192-118 92.944-119.217 10.848-4.944 23.504-3.312 32.88 4.032a32.061 32.061 0 0 1 11.68 31.007c-.336 2.16-9.409 62.033 41.536 146.944 46 76.672 59.28 126.368 59.28 221.681 0 230.48-176.432 397.761-419.536 397.761zm-312.721-555.6c-17.568 44.304-35.665 103.246-35.665 157.806 0 193.408 144.192 333.776 348.368 333.776 206 0 355.536-140.368 355.536-333.776 0-83.536-10.32-122.32-50.16-188.752-26.624-44.368-39.777-84.256-46.065-116-6.336 10.256-12.223 22.784-16.527 37.872-19.504 68.193-14.592 147.937-14.527 148.753.944 14.273-7.744 27.473-21.248 32.257s-28.529.064-36.817-11.663c-2.4-3.408-59.312-83.968-84.4-138.24-52.096-112.592-51.216-234.336-45.904-304.464-52.72 30.72-133.664 99.344-159.664 238.912-25.312 135.808 23.872 271.6 24.4 272.943 4.256 11.088 2 23.664-5.808 32.592-7.84 8.88-19.904 12.815-31.536 10.03-3.967-.975-94.032-24.399-152.336-116.286-10.416-16.464-19.76-36.384-27.647-55.76z" fill="#000"/>
                `);

                // Tamanho do ícone
                svgIcon.css('width', '25px').css('height', '25px');
            }
        });
    });
</script>

