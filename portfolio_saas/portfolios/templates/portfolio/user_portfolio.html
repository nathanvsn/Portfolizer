{% extends 'base.html' %}

{% block title %}Portfólio de {{ portfolio.user.username }}{% endblock %}

{% block js %}
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        marked.setOptions({
            sanitize: true, // Remove tags perigosas como <script>
        });
        

        // Pega o conteúdo markdown bruto
        const rawMarkdown = document.getElementById('raw-markdown').value;

        // Converte para HTML usando Marked.js
        const htmlContent = marked.parse(rawMarkdown);

        // Insere o HTML renderizado na div 'markdown-content'
        document.getElementById('markdown-content').innerHTML = htmlContent;
    });
</script>

{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">

        {% if portfolio.markdown_content %}
        <div class="content">
            <!-- Div onde o HTML renderizado será inserido -->
            <div id="markdown-content"></div>
            <!-- Div escondida contendo o markdown bruto -->
            <textarea id="raw-markdown" style="display:none;">{{ portfolio.markdown_content }}</textarea>
        </div>
        {% else %}

        <h1>Bem-vindo ao Portfólio de {{ portfolio.user.username }}</h1>
        
        <div class="bio">
            <h2>Sobre Mim</h2>
            <p>{{ portfolio.user.bio|default:"Bio não disponível" }}</p>
            <div class="social-links">
                {% if portfolio.user.github %}
                <a href="{{ portfolio.user.github }}" class="btn btn-outline-dark me-2">GitHub</a>
                {% endif %}
                {% if portfolio.user.twitter %}
                <a href="{{ portfolio.user.twitter }}" class="btn btn-outline-dark me-2">Twitter</a>
                {% endif %}
                {% if portfolio.user.linkedin %}
                <a href="{{ portfolio.user.linkedin }}" class="btn btn-outline-dark me-2">LinkedIn</a>
                {% endif %}
            </div>
        </div>
        <!-- Seção Projetos -->
        <div class="row mt-5" id="projetos">
            <div class="col-md-8">
                <h2>Projetos</h2>
                <ul class="list-group">
                    {% for project in projects %}
                    <li class="list-group-item">
                        <a href="{% url 'project_detail' portfolio.user.username project.name %}">
                            {{ project.name }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}
    </div>
</div>



<!-- Markdown Editor (Somente para o proprietário) -->
{% if user == portfolio.user %}
<div class="row mt-5" id="editar">
    <div class="col-md-8">
        <h2>Editar Página Inicial</h2>
        <form method="POST">
            {% csrf_token %}
            <div class="form-group">
                <label for="markdown">Conteúdo Markdown</label>
                <textarea id="markdown" name="markdown_content" class="form-control" rows="10">{{ portfolio.markdown_content }}</textarea>
            </div>
            <button type="submit" class="btn btn-primary mt-2">Salvar</button>
        </form>
    </div>
</div>
{% endif %}
{% endblock %}
